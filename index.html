<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     To the MOUNTAIN
  </title>
  <meta name="generator" content="hexo-theme-yilia-plus">
  
  <link rel="shortcut icon" href="/山.png" />
  
  
<link rel="stylesheet" href="/css/style.css">

  
<script src="/js/pace.min.js"></script>


  

  

<link rel="alternate" href="/atom.xml" title="To the MOUNTAIN" type="application/atom+xml">
</head>

</html>

<body>
  <div id="app">
    <main class="content">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/frontcover.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">To the MOUNTAIN</a></h1>
      <h2>Learn &amp; Life</h2>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>

<div id="main">
  <section class="outer">
  <article class="articles">
    
    
    
    
    <article id="post-【python+geopy包】地理信息检索" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/11/04/%E3%80%90python+geopy%E5%8C%85%E3%80%91%E5%9C%B0%E7%90%86%E4%BF%A1%E6%81%AF%E6%A3%80%E7%B4%A2/"
    >【python+geopy包】地理信息检索</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/11/04/%E3%80%90python+geopy%E5%8C%85%E3%80%91%E5%9C%B0%E7%90%86%E4%BF%A1%E6%81%AF%E6%A3%80%E7%B4%A2/" class="article-date">
  <time datetime="2020-11-04T01:03:12.720Z" itemprop="datePublished">2020-11-04</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%92%8C%E7%BC%96%E7%A8%8B/">软件和编程</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>之前有写过一篇用高德开放平台API接口进行POI信息获取的博客。但是有的时候检索会无法精确定位到单个所需的设施点位置，会返回很多周边的点，此时自己筛选就会有些麻烦。<br>这次，来介绍一个我最近发现的一个很好用的地理信息检索的python包-<strong>geopy</strong>。不需要使用requests库、url，两行代码即可快速检索。</p>
<p>Geopy包官方指南：<a href="https://www.osgeo.cn/geopy/" target="_blank" rel="noopener">https://www.osgeo.cn/geopy/</a></p>
<h2 id="地理编码器"><a href="#地理编码器" class="headerlink" title="地理编码器"></a>地理编码器</h2><p>使用<code>geopy.geocoders</code>调用很多在线地图API服务（如Google地图、Bing地图、百度地图、OpenStreetMap），可以从字符串解析位置，实现经纬度查询，当然也可以逆检索。本次就以<strong>百度地图</strong>和<strong>OpenStreetMap</strong>为例，介绍使用geopy包，快速检索。</p>
<p><strong>1.百度地图需要提前去其开放平台申请AK</strong></p>
<p>注意申请<strong>服务端</strong>的AK</p>
<img src="/2020/11/04/%E3%80%90python+geopy%E5%8C%85%E3%80%91%E5%9C%B0%E7%90%86%E4%BF%A1%E6%81%AF%E6%A3%80%E7%B4%A2/%E7%99%BE%E5%BA%A6%E5%9C%B0%E5%9B%BEAK.png" class title="[百度地图AK]">

<p><strong>2.开始地理编码</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> geopy.geocoders <span class="keyword">import</span> Nominatim,BaiduV3</span><br><span class="line"></span><br><span class="line">geolocator = Nominatim(user_agent=<span class="string">"myapp"</span>)<span class="comment">#基于openStreetMap</span></span><br><span class="line">location = geolocator.geocode(query=<span class="string">"南京站"</span>)</span><br><span class="line">print(location.raw)</span><br><span class="line">print((location.longitude,location.latitude))<span class="comment">#WGS84坐标系</span></span><br><span class="line">print(location.address)</span><br><span class="line"></span><br><span class="line">geolocator = BaiduV3(api_key=<span class="string">'输入你申请的ak'</span>)<span class="comment">#基于百度API构造实例</span></span><br><span class="line">location = geolocator.geocode(query=<span class="string">"南京站"</span>)<span class="comment">#检索字符串</span></span><br><span class="line">print(location.raw)<span class="comment">#返回原始信息</span></span><br><span class="line">print((location.longitude,location.latitude))<span class="comment">#输出百度坐标系下经纬度坐标</span></span><br><span class="line">print(location.address)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">OpenStreetMap结果：</span><br><span class="line">&#123;&#39;place_id&#39;: 304447935, &#39;licence&#39;: &#39;Data © OpenStreetMap contributors, ODbL 1.0. https:&#x2F;&#x2F;osm.org&#x2F;copyright&#39;, &#39;osm_type&#39;: &#39;node&#39;, &#39;osm_id&#39;: 8042210546, &#39;boundingbox&#39;: [&#39;32.0912644&#39;, &#39;32.0913644&#39;, &#39;118.7913084&#39;, &#39;118.7914084&#39;], &#39;lat&#39;: &#39;32.0913144&#39;, &#39;lon&#39;: &#39;118.7913584&#39;, &#39;display_name&#39;: &#39;南京站, 南京站换乘通道, 鼓楼区, 南京市, 盱眙县, 江苏省, 210037, China 中国&#39;, &#39;class&#39;: &#39;railway&#39;, &#39;type&#39;: &#39;stop&#39;, &#39;importance&#39;: 0.11100000000000002&#125;</span><br><span class="line">(118.7913584,32.0913144)</span><br><span class="line">南京站, 南京站换乘通道, 鼓楼区, 南京市, 盱眙县, 江苏省, 210037, China 中国</span><br><span class="line"></span><br><span class="line">百度地图API结果：</span><br><span class="line">&#123;&#39;location&#39;: &#123;&#39;lng&#39;: 118.80371375406085, &#39;lat&#39;: 32.093502120303725&#125;, &#39;precise&#39;: 0, &#39;confidence&#39;: 50, &#39;comprehension&#39;: 0, &#39;level&#39;: &#39;火车站&#39;&#125;</span><br><span class="line">(118.80371375406085,32.093502120303725)</span><br><span class="line">火车站</span><br></pre></td></tr></table></figure>

<h2 id="计算距离"><a href="#计算距离" class="headerlink" title="计算距离"></a>计算距离</h2><p>注意，<code>geopy.distance</code>下的<code>geodestic</code>默认测算的是<strong>WGS-84</strong>坐标系下的大地距离。</p>
<p>刚刚调用百度地图API进行的地理编码检索得到的是百度坐标系下的经纬度，需提前进行转换。</p>
<p>这里还是直接用<strong>OpenStreetMap</strong>下的<strong>WGS-84坐标系</strong>下的经纬度作为示例。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> geopy.geocoders <span class="keyword">import</span> Nominatim<span class="comment">#经纬度检索</span></span><br><span class="line"><span class="keyword">from</span> geopy.distance <span class="keyword">import</span> geodesic<span class="comment">#计算距离</span></span><br><span class="line"></span><br><span class="line">geolocator = Nominatim(user_agent=<span class="string">"myapp"</span>)</span><br><span class="line">location1 = geolocator.geocode(query=<span class="string">"南京站"</span>)</span><br><span class="line">location2 = geolocator.geocode(query=<span class="string">"南京禄口国际机场"</span>)</span><br><span class="line">print((location1.longitude,location1.latitude))</span><br><span class="line">print((location2.longitude, location2.latitude))</span><br><span class="line">print(<span class="string">'两地距离%s公里'</span>%geodesic((location1.latitude,location1.longitude), (location2.latitude,location2.longitude)).km)<span class="comment">#可以设置单位为公里、米、英里等</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">输出结果：</span><br><span class="line">(118.7913584,32.0913144)</span><br><span class="line">(118.87176715003275,31.7324679)</span><br><span class="line">两地距离40.51108155886417公里</span><br></pre></td></tr></table></figure>


      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/11/04/%E3%80%90python+geopy%E5%8C%85%E3%80%91%E5%9C%B0%E7%90%86%E4%BF%A1%E6%81%AF%E6%A3%80%E7%B4%A2/" data-id="ckh2t30m20008u0yp149e2keu"
        class="article-share-link">分享</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/geopy/" rel="tag">geopy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%9C%B0%E5%9B%BEAPI/" rel="tag">地图API</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-基于多元LSTM模型的短时交通流量预测" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/06/15/%E5%9F%BA%E4%BA%8E%E5%A4%9A%E5%85%83LSTM%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9F%AD%E6%97%B6%E4%BA%A4%E9%80%9A%E6%B5%81%E9%87%8F%E9%A2%84%E6%B5%8B/"
    >基于多元LSTM模型的短时交通流量预测</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/06/15/%E5%9F%BA%E4%BA%8E%E5%A4%9A%E5%85%83LSTM%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9F%AD%E6%97%B6%E4%BA%A4%E9%80%9A%E6%B5%81%E9%87%8F%E9%A2%84%E6%B5%8B/" class="article-date">
  <time datetime="2020-06-15T02:19:56.658Z" itemprop="datePublished">2020-06-15</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%92%8C%E7%BC%96%E7%A8%8B/">软件和编程</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>正好这学期选修了一门交通流理论的课程，这里介绍一下我最后的课程论文，如何基于上一篇提到的在PeMS数据库下载到的数据，应用LSTM模型进行短时交通流量预测。</p>
<h2 id="1-数据准备"><a href="#1-数据准备" class="headerlink" title="1. 数据准备"></a>1. 数据准备</h2><p>2019年9月1日至9月28日四周的交通流量数据，数据粒度是5分钟一统计，属性包含流率(veh/ 5 minutes),速度(mph),占有率(%),重车比例(%)。</p>
<img src="/2020/06/15/%E5%9F%BA%E4%BA%8E%E5%A4%9A%E5%85%83LSTM%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9F%AD%E6%97%B6%E4%BA%A4%E9%80%9A%E6%B5%81%E9%87%8F%E9%A2%84%E6%B5%8B/%E6%95%B0%E6%8D%AE%E5%B1%95%E7%A4%BA.PNG" class title="[数据展示]">

<h2 id="2-数据描述性统计"><a href="#2-数据描述性统计" class="headerlink" title="2. 数据描述性统计"></a>2. 数据描述性统计</h2><h3 id="1-绘制流率、速度、密度三参数基本图"><a href="#1-绘制流率、速度、密度三参数基本图" class="headerlink" title="(1) 绘制流率、速度、密度三参数基本图"></a>(1) 绘制流率、速度、密度三参数基本图</h3><img src="/2020/06/15/%E5%9F%BA%E4%BA%8E%E5%A4%9A%E5%85%83LSTM%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9F%AD%E6%97%B6%E4%BA%A4%E9%80%9A%E6%B5%81%E9%87%8F%E9%A2%84%E6%B5%8B/flow&occ.png" class title="[flow&amp;occ]">
<img src="/2020/06/15/%E5%9F%BA%E4%BA%8E%E5%A4%9A%E5%85%83LSTM%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9F%AD%E6%97%B6%E4%BA%A4%E9%80%9A%E6%B5%81%E9%87%8F%E9%A2%84%E6%B5%8B/speed&occ.png" class title="[speed&amp;occ]">
<h3 id="2-概率密度分布"><a href="#2-概率密度分布" class="headerlink" title="(2) 概率密度分布"></a>(2) 概率密度分布</h3><p>绘制流率、速度的概率密度分布图和累积概率密度分布图。</p>
<img src="/2020/06/15/%E5%9F%BA%E4%BA%8E%E5%A4%9A%E5%85%83LSTM%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9F%AD%E6%97%B6%E4%BA%A4%E9%80%9A%E6%B5%81%E9%87%8F%E9%A2%84%E6%B5%8B/%E6%B5%81%E9%87%8F%E7%9A%84%E6%A6%82%E7%8E%87%E5%AF%86%E5%BA%A6%E5%88%86%E5%B8%83.png" class title="[流量的概率密度分布]">
<img src="/2020/06/15/%E5%9F%BA%E4%BA%8E%E5%A4%9A%E5%85%83LSTM%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9F%AD%E6%97%B6%E4%BA%A4%E9%80%9A%E6%B5%81%E9%87%8F%E9%A2%84%E6%B5%8B/%E9%80%9F%E5%BA%A6%E7%9A%84%E6%A6%82%E7%8E%87%E5%AF%86%E5%BA%A6%E5%88%86%E5%B8%83.png" class title="[速度的概率密度分布]">
<h3 id="3-时间序列变化"><a href="#3-时间序列变化" class="headerlink" title="(3) 时间序列变化"></a>(3) 时间序列变化</h3><p>观察流量、重车分布、速度、占有率的时序变化。<br>以9月1日一天的数据为例：</p>
<img src="/2020/06/15/%E5%9F%BA%E4%BA%8E%E5%A4%9A%E5%85%83LSTM%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9F%AD%E6%97%B6%E4%BA%A4%E9%80%9A%E6%B5%81%E9%87%8F%E9%A2%84%E6%B5%8B/%E4%BA%A4%E9%80%9A%E6%B5%81%E4%B8%80%E5%A4%A9.png" class title="[交通流一天]">
<img src="/2020/06/15/%E5%9F%BA%E4%BA%8E%E5%A4%9A%E5%85%83LSTM%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9F%AD%E6%97%B6%E4%BA%A4%E9%80%9A%E6%B5%81%E9%87%8F%E9%A2%84%E6%B5%8B/%E9%80%9F%E5%BA%A6%E5%8D%A0%E6%9C%89%E7%8E%87%E4%B8%80%E5%A4%A9.png" class title="[速度占有率一天]">
<p>所有四周的流量时间序列变化：</p>
<img src="/2020/06/15/%E5%9F%BA%E4%BA%8E%E5%A4%9A%E5%85%83LSTM%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9F%AD%E6%97%B6%E4%BA%A4%E9%80%9A%E6%B5%81%E9%87%8F%E9%A2%84%E6%B5%8B/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%B5%81%E9%87%8F.png" class title="[时间序列流量]">

<h2 id="3-LSTM模型构建"><a href="#3-LSTM模型构建" class="headerlink" title="3. LSTM模型构建"></a>3. LSTM模型构建</h2><p>以前三周数据训练，最后一周数据预测。时间步设为12，即前一个小时预测下一个5分钟。<br>话不多说，直接上代码。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">from</span> keras.preprocessing.sequence <span class="keyword">import</span> TimeseriesGenerator</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> LSTM, Dense, Activation</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> mean_absolute_error <span class="keyword">as</span> mae</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> mean_squared_error <span class="keyword">as</span> mse</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> r2_score</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将序列转换为监督学习问题</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">series_to_supervised</span><span class="params">(datasetX,datasetY,lag)</span>:</span></span><br><span class="line">    print(<span class="string">'x的属性数量'</span>,datasetX.shape[<span class="number">1</span>])</span><br><span class="line">    data_gen = TimeseriesGenerator(datasetX,datasetY, length=lag,</span><br><span class="line">                                   batch_size=<span class="number">1</span>)  <span class="comment"># length是滑lag,sampling_rate是timesteps,batch_size是y的维度</span></span><br><span class="line">    X_out, Y_out = data_gen[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, len(data_gen)):</span><br><span class="line">        batch = data_gen[j]</span><br><span class="line">        x, y = batch</span><br><span class="line">        X_out = np.concatenate((X_out, x))</span><br><span class="line">        Y_out = np.concatenate((Y_out, y))</span><br><span class="line">    X_out = np.delete(X_out, <span class="number">0</span>, axis=<span class="number">0</span>)</span><br><span class="line">    Y_out = np.delete(Y_out, <span class="number">0</span>)</span><br><span class="line">    print(<span class="string">'X shape'</span>,X_out.shape)</span><br><span class="line">    print(<span class="string">'Y shape'</span>, Y_out.shape)</span><br><span class="line">    <span class="keyword">return</span> X_out,Y_out</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载数据集</span></span><br><span class="line">path=<span class="string">'.\'</span></span><br><span class="line"><span class="string">olddf=pd.read_excel(path+'</span>PeMS数据.xlsx<span class="string">',sheet_name='</span>Sheet1<span class="string">')</span></span><br><span class="line"><span class="string">df=olddf.copy(deep=False)</span></span><br><span class="line"><span class="string">df['</span>Flow (Veh/<span class="number">5</span> Minutes)<span class="string">']=df['</span>Flow (Veh/<span class="number">5</span> Minutes)<span class="string">'].map(lambda x:3*x)#转换为veh/h/ln</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#生成lstmX,Y</span></span><br><span class="line"><span class="string">input_attributes=['</span>Flow (Veh/<span class="number">5</span> Minutes)<span class="string">','</span>Occupancy (%)<span class="string">','</span>Speed (mph)<span class="string">','</span>Truck Prop (%)<span class="string">']</span></span><br><span class="line"><span class="string">datasetX=df[input_attributes].values</span></span><br><span class="line"><span class="string">datasetY=df['</span>Flow (Veh/<span class="number">5</span> Minutes)<span class="string">']</span></span><br><span class="line"><span class="string">scalerx = MinMaxScaler(feature_range=(0, 1))</span></span><br><span class="line"><span class="string">scalery = MinMaxScaler(feature_range=(0, 1))</span></span><br><span class="line"><span class="string">X_scaled = scalerx.fit_transform(datasetX)</span></span><br><span class="line"><span class="string">Y_scaled= scalery.fit_transform(np.array(datasetY).reshape(-1, 1))</span></span><br><span class="line"><span class="string">X,Y=series_to_supervised(X_scaled,Y_scaled,12)#12个数据点即1小时</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#划分训练集与测试集</span></span><br><span class="line"><span class="string">X_train,X_test,Y_train,Y_test= train_test_split(X,Y,test_size=0.25,random_state=0)</span></span><br><span class="line"><span class="string">print('</span>X_train shape<span class="string">',X_train.shape)</span></span><br><span class="line"><span class="string">print('</span>X_test shape<span class="string">',X_test.shape)</span></span><br><span class="line"><span class="string">print('</span>Y_train shape<span class="string">',Y_train.shape)</span></span><br><span class="line"><span class="string">print('</span>Y_test shape<span class="string">',Y_test.shape)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#构建模型</span></span><br><span class="line"><span class="string"># input_dim是输入的train_x的最后一个维度，train_x的维度为(n_samples, time_steps, input_dim)</span></span><br><span class="line"><span class="string">model = Sequential()</span></span><br><span class="line"><span class="string">model.add(LSTM(30, input_shape=(X_train.shape[1], X_train.shape[2])))</span></span><br><span class="line"><span class="string">model.add(Dense(1))</span></span><br><span class="line"><span class="string">model.add(Activation('</span>tanh<span class="string">'))</span></span><br><span class="line"><span class="string">model.compile(loss='</span>mse<span class="string">', optimizer='</span>adam<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 拟合神经网络模型</span></span><br><span class="line"><span class="string">history = model.fit(X_train, Y_train, epochs=50, batch_size=64, validation_data=(X_train, Y_train), verbose=2,</span></span><br><span class="line"><span class="string">                    shuffle=False)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 绘制训练loss数据</span></span><br><span class="line"><span class="string">fig1 = plt.figure()</span></span><br><span class="line"><span class="string">ax1 = fig1.add_subplot(111)</span></span><br><span class="line"><span class="string">ax1.plot(history.history['</span>loss<span class="string">'], label='</span>train<span class="string">')</span></span><br><span class="line"><span class="string">ax1.plot(history.history['</span>val_loss<span class="string">'], label='</span>test<span class="string">')</span></span><br><span class="line"><span class="string">ax1.set_ylabel('</span>Loss<span class="string">')</span></span><br><span class="line"><span class="string">ax1.set_xlabel('</span>Epochs<span class="string">')</span></span><br><span class="line"><span class="string">plt.legend()</span></span><br><span class="line"><span class="string">plt.show()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 做出预测</span></span><br><span class="line"><span class="string">yhat = model.predict(X_test)</span></span><br><span class="line"><span class="string">invY_predict=scalery.inverse_transform(np.array(yhat).reshape(-1,1))</span></span><br><span class="line"><span class="string">invY_test=scalery.inverse_transform(np.array(Y_test).reshape(-1,1))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">print('</span>lstm结果<span class="string">')</span></span><br><span class="line"><span class="string">print('</span>r_square<span class="string">', r2_score(invY_test,invY_predict))</span></span><br><span class="line"><span class="string">print('</span>mae<span class="string">', mae(invY_test,invY_predict))</span></span><br><span class="line"><span class="string">print('</span>rmse<span class="string">', np.sqrt(mse(invY_test,invY_predict)))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">fig2 = plt.figure(figsize=(10,7) , dpi=80)</span></span><br><span class="line"><span class="string">ax2 = fig2.add_subplot(111)</span></span><br><span class="line"><span class="string">ax2.plot(invY_test,color='</span>blue<span class="string">', linestyle='</span>-<span class="string">',label='</span>Ground Truth<span class="string">')</span></span><br><span class="line"><span class="string">ax2.plot(invY_predict,color='</span>red<span class="string">', linestyle='</span>--<span class="string">',label='</span>LSTM Prediciton<span class="string">')</span></span><br><span class="line"><span class="string">ax2.set_ylabel('</span>Flow (veh/h/ln)<span class="string">')</span></span><br><span class="line"><span class="string">ax2.set_xlabel('</span>Date<span class="string">')</span></span><br><span class="line"><span class="string">xlabel=[]</span></span><br><span class="line"><span class="string">for i in range(22,30):</span></span><br><span class="line"><span class="string">    xlabel.append('</span><span class="number">9</span>/%d<span class="string">'%(i))</span></span><br><span class="line"><span class="string">ax2.set_xticks(range(0,2304,288))</span></span><br><span class="line"><span class="string">ax2.set_xticklabels(xlabel,rotation=90)</span></span><br><span class="line"><span class="string">plt.legend()</span></span><br><span class="line"><span class="string">plt.show()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#绘制9/28一天的图</span></span><br><span class="line"><span class="string">fig3 = plt.figure(figsize=(10,7) , dpi=80)</span></span><br><span class="line"><span class="string">ax3 = fig3.add_subplot(111)</span></span><br><span class="line"><span class="string">ax3.plot(invY_test[-288:],color='</span>green<span class="string">', linestyle='</span>-<span class="string">',label='</span>Ground Truth<span class="string">')</span></span><br><span class="line"><span class="string">ax3.plot(invY_predict[-288:],color='</span>purple<span class="string">', linestyle='</span>--<span class="string">',label='</span>LSTM Prediciton<span class="string">')</span></span><br><span class="line"><span class="string">ax3.set_ylabel('</span>Flow (veh/h/ln)<span class="string">')</span></span><br><span class="line"><span class="string">ax3.set_xlabel('</span>Time<span class="string">')</span></span><br><span class="line"><span class="string">xlabel=[]</span></span><br><span class="line"><span class="string">for i in range(0,25):</span></span><br><span class="line"><span class="string">    xlabel.append('</span>%d:<span class="number">00</span><span class="string">'%(i))</span></span><br><span class="line"><span class="string">ax3.set_xticks(range(0,289,12))</span></span><br><span class="line"><span class="string">ax3.set_xticklabels(xlabel,rotation=90)</span></span><br><span class="line"><span class="string">plt.legend()</span></span><br><span class="line"><span class="string">plt.show()</span></span><br></pre></td></tr></table></figure>

<h3 id="结果展示："><a href="#结果展示：" class="headerlink" title="结果展示："></a>结果展示：</h3><p>最后一周所有的预测：</p>
<img src="/2020/06/15/%E5%9F%BA%E4%BA%8E%E5%A4%9A%E5%85%83LSTM%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9F%AD%E6%97%B6%E4%BA%A4%E9%80%9A%E6%B5%81%E9%87%8F%E9%A2%84%E6%B5%8B/%E5%85%A8%E9%83%A8%E9%A2%84%E6%B5%8B.png" class title="[全部预测]">
<p>9月28日结果：</p>
<img src="/2020/06/15/%E5%9F%BA%E4%BA%8E%E5%A4%9A%E5%85%83LSTM%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9F%AD%E6%97%B6%E4%BA%A4%E9%80%9A%E6%B5%81%E9%87%8F%E9%A2%84%E6%B5%8B/9.28%E9%A2%84%E6%B5%8B.png" class title="[9.28预测]">
<p>预测的效果还可以，毕竟只设置了单隐层。</p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/06/15/%E5%9F%BA%E4%BA%8E%E5%A4%9A%E5%85%83LSTM%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9F%AD%E6%97%B6%E4%BA%A4%E9%80%9A%E6%B5%81%E9%87%8F%E9%A2%84%E6%B5%8B/" data-id="ckbfvdw930000q4ue3ivebb1d"
        class="article-share-link">分享</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LSTM/" rel="tag">LSTM</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BA%A4%E9%80%9A%E6%B5%81/" rel="tag">交通流</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/" rel="tag">神经网络</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-下载PeMS交通流数据指南" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/06/15/%E4%B8%8B%E8%BD%BDPeMS%E4%BA%A4%E9%80%9A%E6%B5%81%E6%95%B0%E6%8D%AE%E6%8C%87%E5%8D%97/"
    >下载PeMS交通流数据指南</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/06/15/%E4%B8%8B%E8%BD%BDPeMS%E4%BA%A4%E9%80%9A%E6%B5%81%E6%95%B0%E6%8D%AE%E6%8C%87%E5%8D%97/" class="article-date">
  <time datetime="2020-06-15T01:25:29.081Z" itemprop="datePublished">2020-06-15</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%92%8C%E7%BC%96%E7%A8%8B/">软件和编程</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>今天给大家推荐一个开放的交通数据库，美国加州交通运输局的PeMS数据库，这里有着长达10年的高速公路检测器数据。包含流率、速度、占有率、重车比例、延误、车辆行驶里程、车辆行驶时间、交通事故等类型数据。很多学者都用这里的数据进行研究。<br>所以这里给大家介绍一下这个数据库下载数据的使用方式。</p>
<h2 id="1-要有可以科学上网的VPN"><a href="#1-要有可以科学上网的VPN" class="headerlink" title="1. 要有可以科学上网的VPN"></a>1. 要有可以科学上网的VPN</h2><p>这个请先自行解决。</p>
<h2 id="2-登录PeMS网站并注册账号"><a href="#2-登录PeMS网站并注册账号" class="headerlink" title="2. 登录PeMS网站并注册账号"></a>2. 登录PeMS网站并注册账号</h2><p>官方网址：<a href="http://pems.dot.ca.gov/" target="_blank" rel="noopener">http://pems.dot.ca.gov/</a><br>首页右侧有<font color="red">apply for an account</font>的链接，注册完毕后回到首页右上角登陆已通过的注册账号。</p>
<img src="/2020/06/15/%E4%B8%8B%E8%BD%BDPeMS%E4%BA%A4%E9%80%9A%E6%B5%81%E6%95%B0%E6%8D%AE%E6%8C%87%E5%8D%97/PeMS%E9%A6%96%E9%A1%B5.PNG" class title="[PeMS首页]">

<h2 id="3-明确要下载的数据类型：线：路段-点：检测器"><a href="#3-明确要下载的数据类型：线：路段-点：检测器" class="headerlink" title="3. 明确要下载的数据类型：线：路段|点：检测器"></a>3. 明确要下载的数据类型：线：路段|点：检测器</h2><p>登录进去后，可以看到上面有一栏<font color="blue">“Overview, Facilities&amp;Devices, Performance, Data Quality, Events”</font>，这里细分又有很多数据，大家可以自行根据需要点进去查看。<br>这里我主要介绍下载集计的交通流量、速度、占有率等交通流宏观参数数据。</p>
<img src="/2020/06/15/%E4%B8%8B%E8%BD%BDPeMS%E4%BA%A4%E9%80%9A%E6%B5%81%E6%95%B0%E6%8D%AE%E6%8C%87%E5%8D%97/PeMS%E7%99%BB%E9%99%86%E5%90%8E%E7%95%8C%E9%9D%A2.PNG" class title="[PeMS登陆后界面]">
<p>如这张图所示，以下载某个检测器数据为例，我这里下载I5高速公路主线上编号#716895的检测器<font color="blue">Aggregates</font>集计数据。<br>然后就会跳转到这个检测器的数据，并且系统也提供了基础的数据图表供你直观观看。</p>
<img src="/2020/06/15/%E4%B8%8B%E8%BD%BDPeMS%E4%BA%A4%E9%80%9A%E6%B5%81%E6%95%B0%E6%8D%AE%E6%8C%87%E5%8D%97/%E6%A3%80%E6%B5%8B%E5%99%A8%E6%95%B0%E6%8D%AE%E7%A4%BA%E4%BE%8B.PNG" class title="[检测器数据示例]">

<h2 id="4-选择数据的属性和精度"><a href="#4-选择数据的属性和精度" class="headerlink" title="4. 选择数据的属性和精度"></a>4. 选择数据的属性和精度</h2><p>Quantity, Second Quantity:要下载的数据类型，如流量、速度、占有率等。<br>Granularity: 数据精度，月、周、日、5分钟的颗粒度。<br>另外，可以选择数据的日期覆盖时段、节假日、车道等。</p>
<p>然后点击需要下载的数据格式，这里一般下载<font color="blue">EXPORT to.XLS</font>，比较便于后续数据分析。</p>
<p>好了，就是这么简单，下一篇我来介绍一下我如何用这里的数据进行交通流量的时间序列建模预测。</p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/06/15/%E4%B8%8B%E8%BD%BDPeMS%E4%BA%A4%E9%80%9A%E6%B5%81%E6%95%B0%E6%8D%AE%E6%8C%87%E5%8D%97/" data-id="ckbfv5wso0000d8ue1owwgha1"
        class="article-share-link">分享</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BA%A4%E9%80%9A%E6%B5%81/" rel="tag">交通流</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-【Windows+Cygwin+Darknet+OpenCV】简易上手实现YOLOv3目标检测" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/12/%E3%80%90Windows+Cygwin+Darknet+OpenCV%E3%80%91%E7%AE%80%E6%98%93%E4%B8%8A%E6%89%8B%E5%AE%9E%E7%8E%B0YOLOv3%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/"
    >【Windows+Cygwin+Darknet+OpenCV】简易上手实现YOLOv3目标检测</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/12/%E3%80%90Windows+Cygwin+Darknet+OpenCV%E3%80%91%E7%AE%80%E6%98%93%E4%B8%8A%E6%89%8B%E5%AE%9E%E7%8E%B0YOLOv3%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/" class="article-date">
  <time datetime="2020-04-12T12:28:33.311Z" itemprop="datePublished">2020-04-12</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%92%8C%E7%BC%96%E7%A8%8B/">软件和编程</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p><a href="https://pjreddie.com/darknet/yolo/" target="_blank" rel="noopener">YOLO(You only look once)</a>是github上很火的一个目标检测算法。它的官网提供了很方便的用C语言编写的程序<strong>Darknet</strong>。<br>但是官网提供的很方便的编译方法是基于Linux和Mac系统的。我这次来讲讲我是如何在自己windows系统下配置<strong>Darknet</strong>模块的。<br><strong>注：我这次是下了Cygwin来模拟Linux系统，因为不想下体积占据几个G的Visual Studio来进行编译，Cygwin安装包本身只有1.3M大小。<br>如果有Visual Studio，可以参照<a href="https://github.com/AlexeyAB/darknet" target="_blank" rel="noopener">AlexeyAB版本</a>进行配置。</strong></p>
<img src="/2020/04/12/%E3%80%90Windows+Cygwin+Darknet+OpenCV%E3%80%91%E7%AE%80%E6%98%93%E4%B8%8A%E6%89%8B%E5%AE%9E%E7%8E%B0YOLOv3%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/YOLO%E5%AE%98%E7%BD%91.png" class title="[官网图]">

<h2 id="基础配置流程"><a href="#基础配置流程" class="headerlink" title="基础配置流程"></a>基础配置流程</h2><p>配置过程参照官网：<a href="https://pjreddie.com/darknet/yolo/" target="_blank" rel="noopener">https://pjreddie.com/darknet/yolo/</a></p>
<p>(1) 将github上的<a href="https://github.com/pjreddie/darknet" target="_blank" rel="noopener">https://github.com/pjreddie/darknet</a> 整个项目下载到本地电脑。<br>    注：此处建议使用下载.zip压缩包的方式，不是直接用git clone到本地文件夹，不然可能后面会遇到couldn’t open file: data/coco.names的问题。<br>(2) 切换到darknet文件夹，使用make命令编译C语言源文件。<br>此时，Windows系统下在cmd命令行会报错无法使用make命令。因为make是linux系统下编译源文件使用的命令。官网也有注明这些命令只在Linux和Mac系统上测试过，未在windows系统下测试。<br>所以，下载Cygwin软件实现在windows平台模拟linux系统操作命令，而后可以使用make命令编译源码，生成darknet.exe可执行文件。安装配置Cygwin 参照这篇博客以及其下面的问答：<a href="https://blog.csdn.net/chunleixiahe/article/details/55666792" target="_blank" rel="noopener">https://blog.csdn.net/chunleixiahe/article/details/55666792</a></p>
<img src="/2020/04/12/%E3%80%90Windows+Cygwin+Darknet+OpenCV%E3%80%91%E7%AE%80%E6%98%93%E4%B8%8A%E6%89%8B%E5%AE%9E%E7%8E%B0YOLOv3%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/%E5%9C%A8Cygwin%E7%BC%96%E8%AF%91%E6%88%90%E5%8A%9F.png" class title="[在Cygwin编译成功]">
<p>(3)    下载别人已训练好的yolov3.weights模型权重文件，放于darknet根目录下。<br>官网链接（下载较慢）：<a href="https://pjreddie.com/darknet/yolo/" target="_blank" rel="noopener">https://pjreddie.com/darknet/yolo/</a><br>百度云链接：<a href="https://pan.baidu.com/s/1CVgvP4hQQvDNbKmXhmkxqw" target="_blank" rel="noopener">https://pan.baidu.com/s/1CVgvP4hQQvDNbKmXhmkxqw</a> 提取码：jnhn<br>(4) 使用命令./darknet detect cfg/yolov3.cfg yolov3.weights data/dog.jpg完成测试。因为没有配置OpenCV，图片结果不会直接显示的屏幕上，而是存于默认文件夹的根目录predictions.jpg。<br>但是此时默认的程序不会将置信度显示在图片上，只打印于命令行,图片会存于根目录下<code>predictions.jpg</code>。</p>
<img src="/2020/04/12/%E3%80%90Windows+Cygwin+Darknet+OpenCV%E3%80%91%E7%AE%80%E6%98%93%E4%B8%8A%E6%89%8B%E5%AE%9E%E7%8E%B0YOLOv3%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/%E5%AE%98%E6%96%B9%E6%B5%8B%E8%AF%95%E5%9B%BE%E7%89%87%E7%BB%93%E6%9E%9C%E4%B8%8D%E5%90%AB%E7%BD%AE%E4%BF%A1%E5%BA%A6.jpg" class title="[官方测试图片结果不含置信度]">
<p>(5) 为实现将预测的置信度显示于检测结果图片上，更改默认darknet文件夹下的<code>src/image.c</code>文件<code>draw_detections</code>函数。<br>参照：<a href="https://blog.csdn.net/qq_34795071/article/details/86665620" target="_blank" rel="noopener">https://blog.csdn.net/qq_34795071/article/details/86665620</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">int i,j;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; num; ++i)&#123;</span><br><span class="line">    char labelstr[<span class="number">4096</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    int class = -1;</span><br><span class="line">char possible[<span class="number">10</span>];//存放检测的置信值</span><br><span class="line">    <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; classes; ++j)&#123;</span><br><span class="line">  sprintf(possible,<span class="string">"%.2f"</span>,dets[i].prob[j]);//置信值截取小数点后两位赋给possible</span><br><span class="line">        <span class="keyword">if</span> (dets[i].prob[j] &gt; thresh)&#123;</span><br><span class="line">            if (class &lt; 0) &#123;</span><br><span class="line">                strcat(labelstr, names[j]);</span><br><span class="line">        strcat(labelstr, possible);//标签中加入置信值</span><br><span class="line">                class = j;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                strcat(labelstr, <span class="string">", "</span>);</span><br><span class="line">                strcat(labelstr, names[j]);</span><br><span class="line">        strcat(labelstr, possible);//标签中加入置信值</span><br><span class="line">            &#125;</span><br><span class="line">            printf(<span class="string">"%s: %.0f%%\n"</span>, names[j], dets[i].prob[j]*<span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>(6) 删除掉原编译好的darknet.exe, libdarknet.a, libdarknet.so,重新使用make编译源文件，再执行上述检测语句，即可存储含有置信度的图片。</p>
<img src="/2020/04/12/%E3%80%90Windows+Cygwin+Darknet+OpenCV%E3%80%91%E7%AE%80%E6%98%93%E4%B8%8A%E6%89%8B%E5%AE%9E%E7%8E%B0YOLOv3%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/dog_predictions.jpg" class title="[dog_predictions]">
<p>(7) 若想更改检测的默认置信度，在检测命令后添加 -thresh &lt;数值&gt;。<br><code>./darknet detect cfg/yolov3.cfg yolov3.weights data/dog.jpg -thresh 0.4</code></p>
<p><strong>至此已经完成了最基础的Darknet配置来实现YOLOv3算法。</strong></p>
<h2 id="OpenCV拓展实现实时目标检测"><a href="#OpenCV拓展实现实时目标检测" class="headerlink" title="OpenCV拓展实现实时目标检测"></a>OpenCV拓展实现实时目标检测</h2><p>(1)    安装<code>OpenCV</code>，拓展可支持的图片类型，并且将结果自动弹窗显示：<br><code>OpenCV(Windows版本的即可)</code>安装完毕后，需要再次使用<code>Cygwin</code>下载<code>Linux</code>支持的<code>OpenCV</code>相应文件，并将<code>darknet</code>根目录下<code>Makefile</code>用文本打开，开头部分设为OPENCV=1,才可成功编译可支持<code>OpenCV</code>的<code>darknet.exe</code>。<br>编译完基于<code>OpenCV</code>的可执行程序后，不能如原来一样在命令行直接输入检测语句，不然会出现无法展示的报错，配置并启动<code>Xterm</code>才可以解决。</p>
<img src="/2020/04/12/%E3%80%90Windows+Cygwin+Darknet+OpenCV%E3%80%91%E7%AE%80%E6%98%93%E4%B8%8A%E6%89%8B%E5%AE%9E%E7%8E%B0YOLOv3%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/opencv%E9%85%8D%E7%BD%AE%E5%90%8E%E5%9C%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%BC%B9%E6%A1%86%E6%8A%A5%E9%94%99.png" class title="[opencv配置后在命令行弹框报错]">
<p>在<code>Cygwin</code>输入<code>export DISPLAY=:0.0</code>和<code>startxwin &</code>即可启动<code>Xterm</code>，然后输入相应命令，即可出现弹框，如下所示。</p>
<img src="/2020/04/12/%E3%80%90Windows+Cygwin+Darknet+OpenCV%E3%80%91%E7%AE%80%E6%98%93%E4%B8%8A%E6%89%8B%E5%AE%9E%E7%8E%B0YOLOv3%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/%E5%9C%A8Xterm%E6%88%90%E5%8A%9F%E6%98%BE%E7%A4%BA%E8%87%B3%E7%AA%97%E5%8F%A3%E5%B1%8F%E5%B9%95.png" class title="[在Xterm成功显示至窗口屏幕]">
<p><strong>Xterm使用两则小贴士：</strong>（1）鼠标中键实现“粘贴”；（2）ctrl+右键可以改字号。<br>(2) 参照这篇博客<a href="https://blog.csdn.net/weixin_43590290/article/details/100736307?depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2&utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2
">【python+OpenCV+YOLOv3打开笔记本摄像头模型检测】</a>的代码，使用python程序，通过OpenCV调用摄像头实现实时检测。<br>这篇文章调用的是电脑自带摄像头，我通过给安卓手机下载<strong>IP Webcam</strong>软件，实现调用手机摄像头的实时目标检测。<br>具体代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">video_demo</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 加载已经训练好的模型路径，可以是绝对路径或者相对路径</span></span><br><span class="line">    weightsPath = <span class="string">"../yolov3.weights"</span></span><br><span class="line">    configPath = <span class="string">"../cfg/yolov3.cfg"</span></span><br><span class="line">    labelsPath = <span class="string">"../data/coco.names"</span></span><br><span class="line">    <span class="comment"># 初始化一些参数</span></span><br><span class="line">    LABELS = open(labelsPath).read().strip().split(<span class="string">"\n"</span>)  <span class="comment"># 物体类别</span></span><br><span class="line">    COLORS = np.random.randint(<span class="number">0</span>, <span class="number">255</span>, size=(len(LABELS), <span class="number">3</span>), dtype=<span class="string">"uint8"</span>)  <span class="comment"># 颜色</span></span><br><span class="line">    boxes = []</span><br><span class="line">    confidences = []</span><br><span class="line">    classIDs = []</span><br><span class="line">    net = cv2.dnn.readNetFromDarknet(configPath, weightsPath)</span><br><span class="line">    <span class="comment"># 读入待检测的图像</span></span><br><span class="line">    <span class="comment"># 0是代表摄像头编号，只有一个的话默认为0</span></span><br><span class="line"></span><br><span class="line">    url = <span class="string">'http://192.168.0.103:8080/video'</span><span class="comment">##手机ip cam地址</span></span><br><span class="line">    <span class="comment"># url='D:\darknet-master\\airplane.avi'#本地视频</span></span><br><span class="line">    capture = cv2.VideoCapture(url)</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">True</span>):</span><br><span class="line">        ref, image = capture.read()</span><br><span class="line">        (H, W) = image.shape[:<span class="number">2</span>]</span><br><span class="line">        <span class="comment"># 得到 YOLO需要的输出层</span></span><br><span class="line">        ln = net.getLayerNames()</span><br><span class="line">        ln = [ln[i[<span class="number">0</span>] - <span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> net.getUnconnectedOutLayers()]</span><br><span class="line">        <span class="comment"># 从输入图像构造一个blob，然后通过加载的模型，给我们提供边界框和相关概率</span></span><br><span class="line">        blob = cv2.dnn.blobFromImage(image, <span class="number">1</span> / <span class="number">255.0</span>, (<span class="number">416</span>, <span class="number">416</span>), swapRB=<span class="literal">True</span>, crop=<span class="literal">False</span>)</span><br><span class="line">        net.setInput(blob)</span><br><span class="line">        layerOutputs = net.forward(ln)</span><br><span class="line">        <span class="comment"># 在每层输出上循环</span></span><br><span class="line">        <span class="keyword">for</span> output <span class="keyword">in</span> layerOutputs:</span><br><span class="line">            <span class="comment"># 对每个检测进行循环</span></span><br><span class="line">            <span class="keyword">for</span> detection <span class="keyword">in</span> output:</span><br><span class="line">                scores = detection[<span class="number">5</span>:]</span><br><span class="line">                classID = np.argmax(scores)</span><br><span class="line">                confidence = scores[classID]</span><br><span class="line">                <span class="comment"># 过滤掉那些置信度较小的检测结果</span></span><br><span class="line">                <span class="keyword">if</span> confidence &gt; <span class="number">0.5</span>:</span><br><span class="line">                    <span class="comment"># 框后接框的宽度和高度</span></span><br><span class="line">                    box = detection[<span class="number">0</span>:<span class="number">4</span>] * np.array([W, H, W, H])</span><br><span class="line">                    (centerX, centerY, width, height) = box.astype(<span class="string">"int"</span>)</span><br><span class="line">                    <span class="comment"># 边框的左上角</span></span><br><span class="line">                    x = int(centerX - (width / <span class="number">2</span>))</span><br><span class="line">                    y = int(centerY - (height / <span class="number">2</span>))</span><br><span class="line">                    <span class="comment"># 更新检测出来的框</span></span><br><span class="line">                    boxes.append([x, y, int(width), int(height)])</span><br><span class="line">                    confidences.append(float(confidence))</span><br><span class="line">                    classIDs.append(classID)</span><br><span class="line">        <span class="comment"># 极大值抑制</span></span><br><span class="line">        idxs = cv2.dnn.NMSBoxes(boxes, confidences, <span class="number">0.2</span>, <span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> len(idxs) &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> idxs.flatten():</span><br><span class="line">                (x, y) = (boxes[i][<span class="number">0</span>], boxes[i][<span class="number">1</span>])</span><br><span class="line">                (w, h) = (boxes[i][<span class="number">2</span>], boxes[i][<span class="number">3</span>])</span><br><span class="line">                <span class="comment"># 在原图上绘制边框和类别</span></span><br><span class="line">                color = [int(c) <span class="keyword">for</span> c <span class="keyword">in</span> COLORS[classIDs[i]]]</span><br><span class="line">                cv2.rectangle(image, (x, y), (x + w, y + h), color, <span class="number">2</span>)</span><br><span class="line">                text = <span class="string">"&#123;&#125;: &#123;:.4f&#125;"</span>.format(LABELS[classIDs[i]], confidences[i])</span><br><span class="line">                cv2.putText(image, text, (x, y - <span class="number">5</span>), cv2.FONT_HERSHEY_SIMPLEX, <span class="number">0.5</span>, color, <span class="number">2</span>)</span><br><span class="line">        cv2.imshow(<span class="string">"Video"</span>, image)</span><br><span class="line">        <span class="comment"># 等待1ms显示图像</span></span><br><span class="line">        c = cv2.waitKey(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> c &amp; <span class="number">0xFF</span> == ord(<span class="string">'q'</span>):  <span class="comment"># 键盘输入英文字母q键退出视频</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">cv2.destroyAllWindows()  <span class="comment"># 销毁所有窗口</span></span><br><span class="line">video_demo()</span><br></pre></td></tr></table></figure>

<p>下面放一下我实时检测的画面：</p>
<img src="/2020/04/12/%E3%80%90Windows+Cygwin+Darknet+OpenCV%E3%80%91%E7%AE%80%E6%98%93%E4%B8%8A%E6%89%8B%E5%AE%9E%E7%8E%B0YOLOv3%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/%E6%8E%A5%E5%85%A5%E6%89%8B%E6%9C%BA%E6%91%84%E5%83%8F%E5%A4%B4%E5%AE%9E%E6%97%B6%E6%A3%80%E6%B5%8B.jpg" class title="[接入手机摄像头实时检测]">
<img src="/2020/04/12/%E3%80%90Windows+Cygwin+Darknet+OpenCV%E3%80%91%E7%AE%80%E6%98%93%E4%B8%8A%E6%89%8B%E5%AE%9E%E7%8E%B0YOLOv3%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/%E7%94%B5%E8%84%91%E5%AE%9E%E6%97%B6%E6%A3%80%E6%B5%8B%E7%A4%BA%E6%84%8F%E7%94%BB%E9%9D%A2.jpg" class title="[电脑实时检测示意画面]">

<h2 id="配置Darknet走过的一些弯路"><a href="#配置Darknet走过的一些弯路" class="headerlink" title="配置Darknet走过的一些弯路"></a>配置Darknet走过的一些弯路</h2><p>(1)    下载CUDA实现GPU运算：<br>需要自己的显卡比较好，同时配置CUDA、CUDNN均需匹配版本号正确，这两个软件体积也特别大。配置这个很麻烦，Darknet官网也说明了这个安装很麻烦，所以不是长久专门使用，不必配置了。<br>但是没有GPU真的处理视频很卡。。。<br>(2)    一开始的make编译Makefile失败，尝试使用windows系统下的Visual Studio中的nmake等方式失败，尝试用MinGW也失败，最终使用Cygwin模拟linux成功。<br>(3) 基于已有的程序，安装完OpenCV后在模拟Linux系统下的视频流的目标侦测目前还是遇到一些问题，无法正常按帧检测，并实时在屏幕上显示检测结果。花费了2天时间进行尝试，还是没有解决这个bug，暂时放弃。有解决的朋友可以告诉我一下。<br>报错：<br><code>(darknet:3866):GLib-GObject-CRITICAL **: g_object_set: assertion 'G_IS_OBJECT (object)' failed</code></p>
<img src="/2020/04/12/%E3%80%90Windows+Cygwin+Darknet+OpenCV%E3%80%91%E7%AE%80%E6%98%93%E4%B8%8A%E6%89%8B%E5%AE%9E%E7%8E%B0YOLOv3%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/%E8%A7%86%E9%A2%91%E6%8A%A5%E9%94%99.png" class title="[视频报错]">
<p>所以才最后转投了python程序去调用OpenCV做视频检测，如果你只想做图片检测，按照我上面的做法没问题。<br>(4) 所以当我看到最后的别人的博客调用python程序，去查<code>src</code>的源码实现<code>YOLOv3</code>，不需要配置keras和tensorflow，其实以后自己也可以这样做。自己当初放弃<a href="https://github.com/AlexeyAB/darknet" target="_blank" rel="noopener">AlexeyAB版本</a>的python接口是因为它还是需要导入windows编译过后的<code>dll</code>模块，所以放弃。不过，有兴趣的朋友还是可以一试。</p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/04/12/%E3%80%90Windows+Cygwin+Darknet+OpenCV%E3%80%91%E7%AE%80%E6%98%93%E4%B8%8A%E6%89%8B%E5%AE%9E%E7%8E%B0YOLOv3%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/" data-id="ck8x479ba0000iwue93260vf5"
        class="article-share-link">分享</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenCV/" rel="tag">OpenCV</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/YOLO/" rel="tag">YOLO</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB/" rel="tag">图像识别</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-【自然语言处理】Wordcloud词云分析+LDA主题分类" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/02/%E3%80%90%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%E3%80%91Wordcloud%E8%AF%8D%E4%BA%91%E5%88%86%E6%9E%90+LDA%E4%B8%BB%E9%A2%98%E5%88%86%E7%B1%BB/"
    >【自然语言处理】Wordcloud词云分析+LDA主题分类</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/02/%E3%80%90%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%E3%80%91Wordcloud%E8%AF%8D%E4%BA%91%E5%88%86%E6%9E%90+LDA%E4%B8%BB%E9%A2%98%E5%88%86%E7%B1%BB/" class="article-date">
  <time datetime="2020-04-02T08:33:57.535Z" itemprop="datePublished">2020-04-02</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%92%8C%E7%BC%96%E7%A8%8B/">软件和编程</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>最近在一门课上，老师分享了一篇关于应用自然语言处理（NLP）模型分析交通领域研究主题分类的论文，我觉得写得很好很有意思。所以，自己也进行一下尝试。<br>主要分为<strong>Wordcloud词云展示</strong>和<strong>Latent Dirichlet Allocation（LDA）模型主题分类</strong>两部分。</p>
<p>参考文献：<a href="https://www.sciencedirect.com/science/article/pii/S0968090X17300207" target="_blank" rel="noopener">Sun, L., &amp; Yin, Y. (2017). Discovering themes and trends in transportation research using topic modeling. Transportation Research Part C: Emerging Technologies, 77, 49-66. doi:10.1016/j.trc.2017.01.013</a></p>
<p>本次分析的是2017年至2020年发表的交通领域关于<strong>“Mobility-as-a-Service(MaaS)”</strong>的30篇论文的摘要部分。</p>
<img src="/2020/04/02/%E3%80%90%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%E3%80%91Wordcloud%E8%AF%8D%E4%BA%91%E5%88%86%E6%9E%90+LDA%E4%B8%BB%E9%A2%98%E5%88%86%E7%B1%BB/%E6%96%87%E7%8C%AE%E6%A6%82%E8%A7%88.PNG" class title="[文献展示]">

<h2 id="wordcloud词云展示"><a href="#wordcloud词云展示" class="headerlink" title="wordcloud词云展示"></a>wordcloud词云展示</h2><ol>
<li><p>首先对文本进行预处理：</p>
<ul>
<li><p>去除标点符号，按空格拆分句子<br><code>mytext=re.sub(r'[.,()]','',mytext).split(' ') #正侧表达式去除标点</code></p>
</li>
<li><p>用NLTK的wordnet模块进行词形还原</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> nltk.stem <span class="keyword">import</span> WordNetLemmatizer</span><br><span class="line">wnl = WordNetLemmatizer()</span><br><span class="line">remytext = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(mytext)):</span><br><span class="line">    mytext[i]=wnl.lemmatize(mytext[i]) <span class="comment">#词性还原</span></span><br><span class="line">    remytext=remytext+<span class="string">' '</span>+mytext[i]</span><br><span class="line">mytext=remytext</span><br></pre></td></tr></table></figure>

<p><strong>注：wordnet包需要另外独自安装，不然会报如下错误：</strong><br><code>Resource wordnet not found. Please use the NLTK Downloader to obtain the resource:</code></p>
<img src="/2020/04/02/%E3%80%90%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%E3%80%91Wordcloud%E8%AF%8D%E4%BA%91%E5%88%86%E6%9E%90+LDA%E4%B8%BB%E9%A2%98%E5%88%86%E7%B1%BB/wordnet%E7%BC%BA%E5%A4%B1%E6%8A%A5%E9%94%99.PNG" class>
<p><strong>这里补充wordnet包安装方法：</strong><br>  (1) 命令行cmd打开，输入python；<br>(2) 继续输入<code>import nltk</code>和<code>nltk.download()</code>如下图所示：</p>
  <img src="/2020/04/02/%E3%80%90%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%E3%80%91Wordcloud%E8%AF%8D%E4%BA%91%E5%88%86%E6%9E%90+LDA%E4%B8%BB%E9%A2%98%E5%88%86%E7%B1%BB/wordnet%E4%B8%8B%E8%BD%BDcmd.PNG" class>
<p>(3) 可能会报错远程主机强制关闭了一个连接。<br>  解决办法：(1)连VPN (2)利用别人已经下载到本地的wordnet包,具体参照这篇博客。<a href="https://blog.csdn.net/Charchunchiu/article/details/96436736?depth_1-utm_source=distribute.pc_relevant.none-task&utm_source=distribute.pc_relevant.none-task" target="_blank" rel="noopener">Python NLTK WordNet的在线与手动安装方法</a><br>  (4) 正常情况下,弹出如下窗口，选择<code>Corpora/wordnet</code>下载即可。</p>
  <img src="/2020/04/02/%E3%80%90%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%E3%80%91Wordcloud%E8%AF%8D%E4%BA%91%E5%88%86%E6%9E%90+LDA%E4%B8%BB%E9%A2%98%E5%88%86%E7%B1%BB/wordnet%E4%B8%8B%E8%BD%BD%E7%95%8C%E9%9D%A2.PNG" class>
</li>
<li><p>设置停用词</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">from</span> wordcloud <span class="keyword">import</span> STOPWORDS<span class="comment">#导入原有的停用词包</span></span><br><span class="line">    additional_stopwords=[]</span><br><span class="line"><span class="keyword">with</span> open(stopwordsfile,<span class="string">'r'</span>,encoding=<span class="string">'UTF-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">      <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">          additional_stopwords.append(line.replace(<span class="string">"\n"</span>,<span class="string">""</span>))</span><br><span class="line">    stop_words = additional_stopwords + list(STOPWORDS)<span class="comment">#额外添加自己的停用词</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>应用wordcloud包</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> wordcloud <span class="keyword">import</span> WordCloud</span><br><span class="line">wordcloud = WordCloud(stopwords=stop_words,background_color=<span class="string">'white'</span>,collocations=<span class="literal">True</span>,colormap=<span class="string">'viridis'</span>,width=<span class="number">2160</span>,height=<span class="number">1080</span>,max_words=<span class="number">50</span>,prefer_horizontal=<span class="number">1</span>).generate(mytext)</span><br><span class="line">plt.imshow(wordcloud, interpolation=<span class="string">'bilinear'</span>)</span><br><span class="line">plt.axis(<span class="string">"off"</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<img src="/2020/04/02/%E3%80%90%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%E3%80%91Wordcloud%E8%AF%8D%E4%BA%91%E5%88%86%E6%9E%90+LDA%E4%B8%BB%E9%A2%98%E5%88%86%E7%B1%BB/maas%E8%AF%8D%E4%BA%91%E7%BB%93%E6%9E%9C.PNG" class title="[词云展示]">

</li>
</ol>
<h2 id="LDA主题分类"><a href="#LDA主题分类" class="headerlink" title="LDA主题分类"></a>LDA主题分类</h2><p>这里使用<strong>sklearn</strong>的<strong>LDA</strong>包。<br>基于之前的<strong>文本预处理</strong>，还需要转换为<strong>词向量</strong>的形式，才可放入LDA模型训练。<br>具体代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> CountVectorizer <span class="comment">#词向量转换模块</span></span><br><span class="line"><span class="keyword">from</span> sklearn.decomposition <span class="keyword">import</span> LatentDirichletAllocation <span class="keyword">as</span> LDA</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> matplotlib.pyplot <span class="keyword">import</span> MultipleLocator</span><br><span class="line"></span><br><span class="line"><span class="comment">#Initialise the count vectorizer with the English stop words</span></span><br><span class="line">count_vectorizer = CountVectorizer(stop_words=stop_words)<span class="comment">#这里也可以设置停用词</span></span><br><span class="line"><span class="comment"># Fit and transform the processed titles</span></span><br><span class="line">count_data = count_vectorizer.fit_transform(mytext)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_topics</span><span class="params">(model, count_vectorizer, n_top_words)</span>:</span></span><br><span class="line">    words = count_vectorizer.get_feature_names()</span><br><span class="line">    <span class="keyword">for</span> topic_idx, topic <span class="keyword">in</span> enumerate(model.components_):</span><br><span class="line">        print(<span class="string">"\nTopic #%d:"</span> % topic_idx)</span><br><span class="line">        print(<span class="string">" "</span>.join([words[i]</span><br><span class="line">                        <span class="keyword">for</span> i <span class="keyword">in</span> topic.argsort()[:-n_top_words - <span class="number">1</span>:<span class="number">-1</span>]]))</span><br><span class="line">n_topics = range(<span class="number">3</span>,<span class="number">7</span>,<span class="number">1</span>)</span><br><span class="line">perplexityLst = [<span class="number">1.0</span>]*len(n_topics)</span><br><span class="line"></span><br><span class="line"><span class="comment">#训练LDA并打印训练时间</span></span><br><span class="line">lda_models = []</span><br><span class="line"><span class="keyword">for</span> idx, n_topic <span class="keyword">in</span> enumerate(n_topics):</span><br><span class="line">    print(idx,n_topic)</span><br><span class="line">    lda = LDA(n_components=n_topic, max_iter=<span class="number">2000</span>,learning_method=<span class="string">'batch'</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">#                                    perp_tol=0.1, #default</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#                                    doc_topic_prior=1/n_topic, #default</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#                                    topic_word_prior=1/n_topic, #default</span></span><br><span class="line"></span><br><span class="line">                                    verbose=<span class="number">0</span>)</span><br><span class="line">    t0 = time.time()</span><br><span class="line">    lda.fit(count_data)</span><br><span class="line">    perplexityLst[idx] = lda.perplexity(count_data)</span><br><span class="line">    lda_models.append(lda)</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">"# of Topic: %d, "</span> % n_topics[idx])</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">"done in %0.3fs, N_iter %d, "</span> % ((time.time() - t0), lda.n_iter_))</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">"Perplexity Score %0.3f"</span> % perplexityLst[idx])</span><br><span class="line"></span><br><span class="line"><span class="comment">#打印最佳模型</span></span><br><span class="line">number_words=<span class="number">10</span></span><br><span class="line">best_index = perplexityLst.index(min(perplexityLst))</span><br><span class="line">best_n_topic = n_topics[best_index]</span><br><span class="line">best_model = lda_models[best_index]</span><br><span class="line"><span class="keyword">print</span> (<span class="string">"Best # of Topic: "</span>, best_n_topic)</span><br><span class="line">print_topics(best_model, count_vectorizer, number_words)</span><br><span class="line"></span><br><span class="line"><span class="comment">#绘制不同主题数perplexity的不同</span></span><br><span class="line">fig = plt.figure()</span><br><span class="line">ax = fig.add_subplot(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">xaxis=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(n_topics)):</span><br><span class="line">    xaxis.append(n_topics[i])</span><br><span class="line">ax.plot(xaxis, perplexityLst)</span><br><span class="line">x_major_locator=MultipleLocator(<span class="number">1</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">"number of topics"</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">"Approximate Perplexity"</span>)</span><br><span class="line">plt.grid(<span class="literal">True</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p>最终我这里选择了分为3个主题。虽然2个的perplexity效果好一些，但我根据需要选择了3个。</p>
<img src="/2020/04/02/%E3%80%90%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%E3%80%91Wordcloud%E8%AF%8D%E4%BA%91%E5%88%86%E6%9E%90+LDA%E4%B8%BB%E9%A2%98%E5%88%86%E7%B1%BB/perplexity%E6%8C%87%E6%95%B0.PNG" class title="[perplexity指数]">

<p>Topic #1: 城市系统角度<br>model city public business alliance actor efficiency factor system new<br>Topic #2: 各出行模式运营商角度<br>user time market adoption road potential intermediary car operator public<br>Topic #3: 用户出行模式选择角度<br>car public model mode bundle sharing new travel choice demand</p>
<p>好了，这次就到这里了。具体的参数设置还是参照官方文档。</p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/04/02/%E3%80%90%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%E3%80%91Wordcloud%E8%AF%8D%E4%BA%91%E5%88%86%E6%9E%90+LDA%E4%B8%BB%E9%A2%98%E5%88%86%E7%B1%BB/" data-id="ck8ilx0qy00008wue8k758f8o"
        class="article-share-link">分享</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LDA/" rel="tag">LDA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NLP/" rel="tag">NLP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Wordcloud/" rel="tag">Wordcloud</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-使用高德开放平台API获取POI位置和路线信息" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/02/22/%E4%BD%BF%E7%94%A8%E9%AB%98%E5%BE%B7%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0API%E8%8E%B7%E5%8F%96POI%E4%BD%8D%E7%BD%AE%E5%92%8C%E8%B7%AF%E7%BA%BF%E4%BF%A1%E6%81%AF/"
    >使用高德开放平台API获取POI位置和路线信息</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/02/22/%E4%BD%BF%E7%94%A8%E9%AB%98%E5%BE%B7%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0API%E8%8E%B7%E5%8F%96POI%E4%BD%8D%E7%BD%AE%E5%92%8C%E8%B7%AF%E7%BA%BF%E4%BF%A1%E6%81%AF/" class="article-date">
  <time datetime="2020-02-22T05:47:55.321Z" itemprop="datePublished">2020-02-22</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%92%8C%E7%BC%96%E7%A8%8B/">软件和编程</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>借助地图API接口，帮助我们快速获取大量的静态、动态数据是非常有效的。<br>这次我就来讲讲怎么利用高德开发平台API接口，获取一些设施位置和路径规划信息。</p>
<h2 id="高德开放平台"><a href="#高德开放平台" class="headerlink" title="高德开放平台"></a>高德开放平台</h2><p><a href="https://lbs.amap.com/api/webservice/summary" target="_blank" rel="noopener">高德开放平台</a>可以让你自己开发的应用嵌入高德服务，使用高德在地理信息服务上的贡献。<br>因为这次我主要需要用到的是一些信息搜索，所以用的是<code>开发支持->Web服务->Web服务API</code>，其他需要移动应用开发的可以去查询<strong>开发支持</strong>下的<strong>Web端、Andriod平台、IOS平台、微信小程序</strong>等等。</p>
<img src="/2020/02/22/%E4%BD%BF%E7%94%A8%E9%AB%98%E5%BE%B7%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0API%E8%8E%B7%E5%8F%96POI%E4%BD%8D%E7%BD%AE%E5%92%8C%E8%B7%AF%E7%BA%BF%E4%BF%A1%E6%81%AF/web_API_intro.PNG" class>
<p>如平台的简介，它可以帮你实现搜索、路径规划、行驶距离测量等功能。</p>
<h3 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1. 准备工作"></a>1. 准备工作</h3><p>申请一个高德的适用于Web服务的<code>key</code>，之后在<code>URL</code>里需要填上自己的<code>key</code>。注意个人用户每日每个key的使用次数是有限额的，超限了查询信息返回会报错，但一个人可以申请好多个。</p>
<img src="/2020/02/22/%E4%BD%BF%E7%94%A8%E9%AB%98%E5%BE%B7%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0API%E8%8E%B7%E5%8F%96POI%E4%BD%8D%E7%BD%AE%E5%92%8C%E8%B7%AF%E7%BA%BF%E4%BF%A1%E6%81%AF/key.PNG" class>

<h3 id="2-根据需要填充URL关键字"><a href="#2-根据需要填充URL关键字" class="headerlink" title="2. 根据需要填充URL关键字"></a>2. 根据需要填充URL关键字</h3><p>我们这次用<code>关键字搜索</code>功能，来查询POI(point of interest)信息，以查询某一城市的机场、火车站的枢纽地理信息为例。<br>根据开发文档提供的URL示例:<code><a href="https://restapi.amap.com/v3/place/text?parameters" target="_blank" rel="noopener">https://restapi.amap.com/v3/place/text?parameters</a></code><br>我们把<code>parameters</code>替换为搜索时限定的一些关键词，并且用<code>&</code>连接不同的条件，记得替换你自己申请的key。<br>比如：<code><a href="https://restapi.amap.com/v3/place/text?keywords=火车站&amp;city=北京&amp;citylimit=true&amp;extensions=all&amp;key=你申请的key&amp;offset=20&amp;page=1" target="_blank" rel="noopener">https://restapi.amap.com/v3/place/text?keywords=火车站&amp;city=北京&amp;citylimit=true&amp;extensions=all&amp;key=你申请的key&amp;offset=20&amp;page=1</a></code></p>
<img src="/2020/02/22/%E4%BD%BF%E7%94%A8%E9%AB%98%E5%BE%B7%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0API%E8%8E%B7%E5%8F%96POI%E4%BD%8D%E7%BD%AE%E5%92%8C%E8%B7%AF%E7%BA%BF%E4%BF%A1%E6%81%AF/keywords_search.PNG" class>

<p>返回的结果，也是参照开发文档，注意弄清层级结构，即可获取对应信息，默认返回<code>json</code>格式。</p>
<img src="/2020/02/22/%E4%BD%BF%E7%94%A8%E9%AB%98%E5%BE%B7%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0API%E8%8E%B7%E5%8F%96POI%E4%BD%8D%E7%BD%AE%E5%92%8C%E8%B7%AF%E7%BA%BF%E4%BF%A1%E6%81%AF/result_parameter.PNG" class>

<p>我这里会主要想要获取经纬度信息，在<code>['pois']->['poi']->['location']</code>下面。</p>
<h3 id="3-使用python批量访问获取结果"><a href="#3-使用python批量访问获取结果" class="headerlink" title="3. 使用python批量访问获取结果"></a>3. 使用python批量访问获取结果</h3><p>用python的<code>requests</code>库，获取访问结果，完整代码如下。这里用简单的<code>GET</code>方式填充URL的参数即可，以后自己爬其他的信息还有可能要用到<code>POST</code>方式，但以字典方式传送参数也是一样的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_station</span><span class="params">(city,type)</span>:</span>  <span class="comment"># 抓取场站信息</span></span><br><span class="line">    url1 = <span class="string">"https://restapi.amap.com/v3/place/text?keywords=%s&amp;city=%s&amp;citylimit=true&amp;extensions=all&amp;key=你自己申请的key&amp;offset=20&amp;page=%d"</span>%(type,city,<span class="number">1</span>)<span class="comment">#查询机场和火车站的经纬度信息</span></span><br><span class="line">    req = requests.get(url1)  <span class="comment"># 请求高德地图Place API返回数据</span></span><br><span class="line">    content = req.content</span><br><span class="line">    data = json.loads(content)  <span class="comment"># 将获取的信息封装为字典</span></span><br><span class="line">    num=int(data[<span class="string">'count'</span>])  <span class="comment"># 提取场站总数</span></span><br><span class="line">    result = data[<span class="string">'pois'</span>]  <span class="comment"># 提取字典中的有效信息</span></span><br><span class="line">    print(num)</span><br><span class="line"></span><br><span class="line">    infoDf = pd.DataFrame(columns=[<span class="string">'名称'</span>, <span class="string">'经度'</span>, <span class="string">'纬度'</span>, <span class="string">'城市'</span>, <span class="string">'类型'</span>, <span class="string">'别名'</span>])</span><br><span class="line">    <span class="keyword">if</span> num==<span class="number">0</span>:<span class="comment">#返回有数据的情况下</span></span><br><span class="line">        print(<span class="string">'%s无%s'</span>%(city,type))</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#第一次的信息别浪费了</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(result)):</span><br><span class="line">        print(i)</span><br><span class="line">        str_temp = result[i]  <span class="comment"># 保存总数到链表第一个元素</span></span><br><span class="line">        <span class="keyword">if</span> len(str_temp[<span class="string">'alias'</span>]) == <span class="number">0</span>:</span><br><span class="line">            alias = <span class="string">''</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            alias = str_temp[<span class="string">'alias'</span>]</span><br><span class="line">    </span><br><span class="line">        print(str_temp[<span class="string">'name'</span>],str_temp[<span class="string">'location'</span>].split(<span class="string">','</span>)[<span class="number">0</span>],str_temp[<span class="string">'location'</span>].split(<span class="string">','</span>)[<span class="number">1</span>],str_temp[<span class="string">'cityname'</span>],alias)</span><br><span class="line">        singleinfo=&#123;<span class="string">'名称'</span>:str_temp[<span class="string">'name'</span>],<span class="string">'经度'</span>:str_temp[<span class="string">'location'</span>].split(<span class="string">','</span>)[<span class="number">0</span>],<span class="string">'纬度'</span>:str_temp[<span class="string">'location'</span>].split(<span class="string">','</span>)[<span class="number">1</span>],<span class="string">'城市'</span>:str_temp[<span class="string">'cityname'</span>],<span class="string">'类型'</span>:type,<span class="string">'别名'</span>:alias&#125;</span><br><span class="line">        singleinfoDf=pd.DataFrame(singleinfo,columns=[<span class="string">'名称'</span>, <span class="string">'经度'</span>, <span class="string">'纬度'</span>, <span class="string">'城市'</span>,<span class="string">'类型'</span>,<span class="string">'别名'</span>],index = [<span class="number">0</span>])</span><br><span class="line">        infoDf = pd.concat([infoDf, singleinfoDf], axis=<span class="number">0</span>, ignore_index=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    totalpage=math.ceil(num/<span class="number">20</span>)<span class="comment">#每一页显示20条数据，算好页数</span></span><br><span class="line">    <span class="keyword">if</span> totalpage &gt;<span class="number">1</span> :</span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">2</span>,totalpage+<span class="number">1</span>):<span class="comment">#从第2页起</span></span><br><span class="line">            url2 = <span class="string">"https://restapi.amap.com/v3/place/text?keywords=%s&amp;city=%s&amp;citylimit=true&amp;extensions=all&amp;key=e3bc4d79724c51578f54e141d4085394&amp;offset=20&amp;page=%d"</span>%(type,city,n)<span class="comment">#查询机场和火车站的经纬度信息</span></span><br><span class="line">            req = requests.get(url2)  <span class="comment"># 请求高德地图Place API返回数据</span></span><br><span class="line">            content = req.content</span><br><span class="line">            data = json.loads(content)  <span class="comment"># 将获取的信息封装为字典</span></span><br><span class="line">            result = data[<span class="string">'pois'</span>]  <span class="comment"># 提取字典中的有效信息</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(len(result)):</span><br><span class="line">                print(i)</span><br><span class="line">                str_temp = result[i]  <span class="comment"># 保存总数到链表第一个元素</span></span><br><span class="line">                <span class="keyword">if</span> len(str_temp[<span class="string">'alias'</span>])==<span class="number">0</span>:</span><br><span class="line">                    alias=<span class="string">''</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    alias=str_temp[<span class="string">'alias'</span>]</span><br><span class="line">                singleinfo = &#123;<span class="string">'名称'</span>: str_temp[<span class="string">'name'</span>], <span class="string">'经度'</span>: str_temp[<span class="string">'location'</span>].split(<span class="string">','</span>)[<span class="number">0</span>],</span><br><span class="line">                              <span class="string">'纬度'</span>: str_temp[<span class="string">'location'</span>].split(<span class="string">','</span>)[<span class="number">1</span>], <span class="string">'城市'</span>: str_temp[<span class="string">'cityname'</span>],<span class="string">'类型'</span>:type, <span class="string">'别名'</span>: alias&#125;</span><br><span class="line">                singleinfoDf = pd.DataFrame(singleinfo,columns=[<span class="string">'名称'</span>, <span class="string">'经度'</span>, <span class="string">'纬度'</span>, <span class="string">'城市'</span>,<span class="string">'类型'</span>,<span class="string">'别名'</span>],index = [<span class="number">0</span>])</span><br><span class="line">                infoDf = pd.concat([infoDf,singleinfoDf],axis=<span class="number">0</span>,ignore_index=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> infoDf</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span>  <span class="comment"># 开始抓取文件</span></span><br><span class="line">    citylist=[<span class="string">'石家庄'</span>,<span class="string">'唐山'</span>,<span class="string">'邯郸'</span>,<span class="string">'保定'</span>,<span class="string">'沧州'</span>,<span class="string">'邢台'</span>,<span class="string">'廊坊'</span>,<span class="string">'承德'</span>,<span class="string">'张家口'</span>,<span class="string">'衡水'</span>,<span class="string">'秦皇岛'</span>]<span class="comment">#,'张家口','衡水','秦皇岛'</span></span><br><span class="line">    typelist=[<span class="string">'机场'</span>,<span class="string">'火车站'</span>]</span><br><span class="line">    whole_info = pd.DataFrame(columns=[<span class="string">'名称'</span>, <span class="string">'经度'</span>, <span class="string">'纬度'</span>, <span class="string">'城市'</span>,<span class="string">'类型'</span>,<span class="string">'别名'</span>])</span><br><span class="line">    <span class="keyword">for</span> cityname <span class="keyword">in</span> citylist:</span><br><span class="line">        <span class="keyword">for</span> type <span class="keyword">in</span> typelist:</span><br><span class="line">            info = get_station(cityname,type)</span><br><span class="line">            whole_info=  pd.concat([whole_info,info],axis=<span class="number">0</span>,ignore_index=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    whole_info.to_csv(<span class="string">'/京津冀机场火车站信息.csv'</span>,index=<span class="literal">False</span>,encoding=<span class="string">'utf_8_sig'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    run()</span><br></pre></td></tr></table></figure>

<p><strong>类似地，大家可以参照以上代码，去查询一下餐厅、公交站等其他设施的信息。</strong></p>
<h3 id="获取路径规划信息"><a href="#获取路径规划信息" class="headerlink" title="*获取路径规划信息"></a>*获取路径规划信息</h3><p>刚才是介绍如何用<code>关键字搜索</code>功能，进行一些POI点的信息查询。现在做一些稍微复杂一点点的更深入的查询。<br>查询两个点之间的不同交通方式的路径规划信息，比如<strong>驾车路线、耗时、距离，公交的路线、耗时、花费</strong>等。<br>此时查询<a href="https://lbs.amap.com/api/webservice/guide/api/direction" target="_blank" rel="noopener">路径规划</a>的对应开发文档。</p>
<img src="/2020/02/22/%E4%BD%BF%E7%94%A8%E9%AB%98%E5%BE%B7%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0API%E8%8E%B7%E5%8F%96POI%E4%BD%8D%E7%BD%AE%E5%92%8C%E8%B7%AF%E7%BA%BF%E4%BF%A1%E6%81%AF/route_planning.PNG" class>

<ul>
<li><p>驾车路径规划<br>同理，弄清URL需要填充的参数。<br><code><a href="https://restapi.amap.com/v3/direction/driving?parameters" target="_blank" rel="noopener">https://restapi.amap.com/v3/direction/driving?parameters</a></code><br>我的示例:<code><a href="https://restapi.amap.com/v3/direction/driving?origin=116.603039,40.080525&amp;destination=116.427694,39.902779&amp;strategy=10&amp;output=json&amp;extensions=all&amp;key=你申请的key" target="_blank" rel="noopener">https://restapi.amap.com/v3/direction/driving?origin=116.603039,40.080525&amp;destination=116.427694,39.902779&amp;strategy=10&amp;output=json&amp;extensions=all&amp;key=你申请的key</a></code><br>我这里就是用刚才查询到的北京首都国际机场的经纬度和北京站的经纬度，查询其之间的驾车路径策略。<br>然后可以请求访问<code>URL</code>，获取很多有用的信息，驾车路线、耗时、距离，乃至具体的导航方案、道路的红绿灯情况等等。</p>
</li>
<li><p>公交路径规划<br><code><a href="https://restapi.amap.com/v3/direction/transit/integrated?parameters" target="_blank" rel="noopener">https://restapi.amap.com/v3/direction/transit/integrated?parameters</a></code><br>我的示例:<code><a href="https://restapi.amap.com/v3/direction/transit/integrated?origin=116.603039,40.080525&amp;destination=116.427694,39.902779&amp;city=北京&amp;strategy=0&amp;output=json&amp;extensions=all&amp;key=你申请的key" target="_blank" rel="noopener">https://restapi.amap.com/v3/direction/transit/integrated?origin=116.603039,40.080525&amp;destination=116.427694,39.902779&amp;city=北京&amp;strategy=0&amp;output=json&amp;extensions=all&amp;key=你申请的key</a></code><br>相似地查询公交策略，这里你可以选择根据不同策略，返回不同地路线，比如换乘最少、耗时最短等等。</p>
</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>高德开发平台API会在查询一些信息时，起到很大帮助（百度开放平台API也是有相似的功能）。重点要去研读一下他们提供的<strong>开发文档</strong>，并且知道<code>URL</code>的组成，这样你就可以个性化的获取你想要的信息了。</li>
<li>更多的内容，还是需要自己去不断发掘。</li>
</ul>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/02/22/%E4%BD%BF%E7%94%A8%E9%AB%98%E5%BE%B7%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0API%E8%8E%B7%E5%8F%96POI%E4%BD%8D%E7%BD%AE%E5%92%8C%E8%B7%AF%E7%BA%BF%E4%BF%A1%E6%81%AF/" data-id="ck8ilx0rt000f8wueb04ia06j"
        class="article-share-link">分享</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/API/" rel="tag">API</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTML/" rel="tag">HTML</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%9C%B0%E7%90%86%E4%BF%A1%E6%81%AF/" rel="tag">地理信息</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-下载Bing搜索界面每日高清美图方法" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/02/02/%E4%B8%8B%E8%BD%BDBing%E6%90%9C%E7%B4%A2%E7%95%8C%E9%9D%A2%E6%AF%8F%E6%97%A5%E9%AB%98%E6%B8%85%E7%BE%8E%E5%9B%BE%E6%96%B9%E6%B3%95/"
    >下载Bing搜索界面每日高清美图方法</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/02/02/%E4%B8%8B%E8%BD%BDBing%E6%90%9C%E7%B4%A2%E7%95%8C%E9%9D%A2%E6%AF%8F%E6%97%A5%E9%AB%98%E6%B8%85%E7%BE%8E%E5%9B%BE%E6%96%B9%E6%B3%95/" class="article-date">
  <time datetime="2020-02-02T07:23:34.914Z" itemprop="datePublished">2020-02-02</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%A7%86%E8%A7%89%E5%92%8C%E6%91%84%E5%BD%B1/">视觉和摄影</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="Bing搜索的每日一图真的很好看，该如何下载呢？"><a href="#Bing搜索的每日一图真的很好看，该如何下载呢？" class="headerlink" title="Bing搜索的每日一图真的很好看，该如何下载呢？"></a><a href="https://cn.bing.com/" target="_blank" rel="noopener">Bing搜索</a>的每日一图真的很好看，该如何下载呢？</h3><ul>
<li><p>进入Bing搜索主页</p>
<img src="/2020/02/02/%E4%B8%8B%E8%BD%BDBing%E6%90%9C%E7%B4%A2%E7%95%8C%E9%9D%A2%E6%AF%8F%E6%97%A5%E9%AB%98%E6%B8%85%E7%BE%8E%E5%9B%BE%E6%96%B9%E6%B3%95/Bing%E9%A6%96%E9%A1%B5.PNG" class>
</li>
<li><p>按<code>F12</code>打开控制台。<br>在<code>Elements</code>下的<code>head</code>中找到图片链接地址。</p>
<img src="/2020/02/02/%E4%B8%8B%E8%BD%BDBing%E6%90%9C%E7%B4%A2%E7%95%8C%E9%9D%A2%E6%AF%8F%E6%97%A5%E9%AB%98%E6%B8%85%E7%BE%8E%E5%9B%BE%E6%96%B9%E6%B3%95/head%E9%93%BE%E6%8E%A5.PNG" class>
<p>复制粘贴到浏览器打开，右键图片另存为即可下载<code>1920*1080</code>分辨率无水印的图。<br>如果想下载更高清的<code>UHD</code>大图，将链接两处<code>1920*1080</code>的部分改为<code>UHD</code>即可。</p>
</li>
<li><p>如果想下载前几天的图。<br>点<code>Network</code>,按<code>Ctrl+R</code>刷新页面，再点首页右下角的向左的箭头，前面图片的链接就会显示出来。<br>同理复制链接粘贴打开下载。</p>
<img src="/2020/02/02/%E4%B8%8B%E8%BD%BDBing%E6%90%9C%E7%B4%A2%E7%95%8C%E9%9D%A2%E6%AF%8F%E6%97%A5%E9%AB%98%E6%B8%85%E7%BE%8E%E5%9B%BE%E6%96%B9%E6%B3%95/%E5%89%8D%E9%9D%A2%E9%93%BE%E6%8E%A5.PNG" class>
</li>
<li><p><strong>最后还是要注意，图片有版权，不能商业使用。</strong></p>
</li>
</ul>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/02/02/%E4%B8%8B%E8%BD%BDBing%E6%90%9C%E7%B4%A2%E7%95%8C%E9%9D%A2%E6%AF%8F%E6%97%A5%E9%AB%98%E6%B8%85%E7%BE%8E%E5%9B%BE%E6%96%B9%E6%B3%95/" data-id="ck8ilx0rp00098wue3v5xadzk"
        class="article-share-link">分享</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTML/" rel="tag">HTML</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BE%8E%E5%9B%BE/" rel="tag">美图</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-配置Hexo的历程和一些bug解决方案" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/28/%E9%85%8D%E7%BD%AEHexo%E7%9A%84%E5%8E%86%E7%A8%8B%E5%92%8C%E4%B8%80%E4%BA%9Bbug%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"
    >配置Hexo的历程和一些bug解决方案</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/01/28/%E9%85%8D%E7%BD%AEHexo%E7%9A%84%E5%8E%86%E7%A8%8B%E5%92%8C%E4%B8%80%E4%BA%9Bbug%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" class="article-date">
  <time datetime="2020-01-28T12:45:01.015Z" itemprop="datePublished">2020-01-28</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%92%8C%E7%BC%96%E7%A8%8B/">软件和编程</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>这篇主要来讲讲我怎么入手搭建自己的Hexo博客。我主要是按照这篇教程<strong><a href="https://sunhwee.com/posts/6e8839eb.html" target="_blank" rel="noopener">Hexo+Github博客搭建完全教程</a></strong>来做的，感谢<strong><a href="https://sunhwee.com/" target="_blank" rel="noopener">洪卫</a></strong> ，他已经写的非常详细了。<br>请大家按照这个教程先做下去！有遇到其他问题可以来看看我的回答，也许能帮到你哦。<br>我主要会补充一些这篇文章中<font color="#2e6da4">没有提到的问题和解决方案</font>。</p>
<h2 id="1-安装hexo报错bash-hexo-command-not-found"><a href="#1-安装hexo报错bash-hexo-command-not-found" class="headerlink" title="1. 安装hexo报错bash: hexo: command not found"></a>1. 安装hexo报错bash: hexo: command not found</h2><p>在验证<code>npm</code>和<code>node</code>安装正确的情况下,输入<code>npm install -g hexo-cli</code>这条语句后，会经过漫长等待并出现很多<code>error</code>，再输入<code>hexo -v</code>报错<code>bash: hexo: command not found</code>说没有安装成功。这是国内镜像源的问题，使用淘宝镜像安装。<br>先输入<code>npm config set registry &quot;https://registry.npm.taobao.org&quot;</code>，再输入<code>npm install hexo-cli g</code>。就会加快安装并且成功啦。</p>
<h2 id="2-hexo-init-超级慢"><a href="#2-hexo-init-超级慢" class="headerlink" title="2. hexo init 超级慢"></a>2. hexo init 超级慢</h2><p>使用淘宝镜像初始化，在<code>hexo init MyBlog</code>之前，先输入<code>npm --registry https://registry.npm.taobao.org info underscore</code>，然后再输入<code>hexo init MyBlog</code>，接着就可以照着<strong><a href="https://sunhwee.com/posts/6e8839eb.html" target="_blank" rel="noopener">洪卫的博客</a></strong>继续做下去啦。</p>
<h2 id="3-ssh-key-配置"><a href="#3-ssh-key-配置" class="headerlink" title="3. ssh-key 配置"></a>3. ssh-key 配置</h2><p>当输入完<code>ssh-keygen -t rsa -C &quot;youremail&quot;</code>之后，系统会让你输入一个文件夹路径来保存<code>id_rsa.pub</code>和<code>id_rsa</code>文件，建议你输入你的博客的完整根目录。<br>比如我的就是<code>D:\software\web storm project\EvaBlog</code>。<br>在github上传公钥的时候，就可以找到这个文件<code>id_rsa.pub</code>将内容复制过去。<br>也许你会收到报错<code>Permission denied (publickey)</code>，很大概率是因为网速，你过一会儿再试一遍<code>ssh -T git@gitee.com</code>，就能看到对你say Hi和告知successfully了！</p>
<h2 id="4-用markdown语法-img-png-本地图片显示不出来"><a href="#4-用markdown语法-img-png-本地图片显示不出来" class="headerlink" title="4. 用markdown语法![](/img.png)本地图片显示不出来"></a>4. 用markdown语法<code>![](/img.png)</code>本地图片显示不出来</h2><p>参考链接:<a href="https://hexo.io/zh-cn/docs/asset-folders" target="_blank" rel="noopener">hexo官方资源文件夹设置</a><br>         <a href="https://blog.csdn.net/xjm850552586/article/details/84101345" target="_blank" rel="noopener">hexo引用本地图片无法显示</a><br>这是hexo的问题。首先我们需要安装一个图片路径转换的插件，这个插件名字是<code>hexo-asset-image</code>。</p>
<ul>
<li>安装：<code>npm install https://github.com/CodeFalling/hexo-asset-image --save</code></li>
<li>更改根目录下的<code>_config.yml</code>文件，修改<code>post_asset_folder: true</code>。</li>
<li>然后参照<a href="https://blog.csdn.net/xjm850552586/article/details/84101345" target="_blank" rel="noopener">这篇博文</a>更改<code>/node_modules/hexo-asset-image/index.js</code>下的配置。<br></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"><span class="keyword">var</span> cheerio = <span class="built_in">require</span>(<span class="string">'cheerio'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// http://stackoverflow.com/questions/14480345/how-to-get-the-nth-occurrence-in-a-string</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPosition</span>(<span class="params">str, m, i</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str.split(m, i).join(m).length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> version = <span class="built_in">String</span>(hexo.version).split(<span class="string">'.'</span>);</span><br><span class="line">hexo.extend.filter.register(<span class="string">'after_post_render'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> config = hexo.config;</span><br><span class="line">  <span class="keyword">if</span>(config.post_asset_folder)&#123;</span><br><span class="line">    	<span class="keyword">var</span> link = data.permalink;</span><br><span class="line">	<span class="keyword">if</span>(version.length &gt; <span class="number">0</span> &amp;&amp; <span class="built_in">Number</span>(version[<span class="number">0</span>]) == <span class="number">3</span>)</span><br><span class="line">	   <span class="keyword">var</span> beginPos = getPosition(link, <span class="string">'/'</span>, <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	   <span class="keyword">var</span> beginPos = getPosition(link, <span class="string">'/'</span>, <span class="number">3</span>) + <span class="number">1</span>;</span><br><span class="line">	<span class="comment">// In hexo 3.1.1, the permalink of "about" page is like ".../about/index.html".</span></span><br><span class="line">	<span class="keyword">var</span> endPos = link.lastIndexOf(<span class="string">'/'</span>) + <span class="number">1</span>;</span><br><span class="line">    link = link.substring(beginPos, endPos);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> toprocess = [<span class="string">'excerpt'</span>, <span class="string">'more'</span>, <span class="string">'content'</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; toprocess.length; i++)&#123;</span><br><span class="line">      <span class="keyword">var</span> key = toprocess[i];</span><br><span class="line">     </span><br><span class="line">      <span class="keyword">var</span> $ = cheerio.load(data[key], &#123;</span><br><span class="line">        ignoreWhitespace: <span class="literal">false</span>,</span><br><span class="line">        xmlMode: <span class="literal">false</span>,</span><br><span class="line">        lowerCaseTags: <span class="literal">false</span>,</span><br><span class="line">        decodeEntities: <span class="literal">false</span></span><br><span class="line">      &#125;);</span><br><span class="line">    </span><br><span class="line">      $(<span class="string">'img'</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    	<span class="keyword">if</span> ($(<span class="keyword">this</span>).attr(<span class="string">'src'</span>))&#123;</span><br><span class="line">    		<span class="comment">// For windows style path, we replace '\' to '/'.</span></span><br><span class="line">    		<span class="keyword">var</span> src = $(<span class="keyword">this</span>).attr(<span class="string">'src'</span>).replace(<span class="string">'\\'</span>, <span class="string">'/'</span>);</span><br><span class="line">    		<span class="keyword">if</span>(!<span class="regexp">/http[s]*.*|\/\/.*/</span>.test(src) &amp;&amp;</span><br><span class="line">    		   !<span class="regexp">/^\s*\//</span>.test(src)) &#123;</span><br><span class="line">    		  <span class="comment">// For "about" page, the first part of "src" can't be removed.</span></span><br><span class="line">    		  <span class="comment">// In addition, to support multi-level local directory.</span></span><br><span class="line">    		  <span class="keyword">var</span> linkArray = link.split(<span class="string">'/'</span>).filter(<span class="function"><span class="keyword">function</span>(<span class="params">elem</span>)</span>&#123;</span><br><span class="line">    			<span class="keyword">return</span> elem != <span class="string">''</span>;</span><br><span class="line">    		  &#125;);</span><br><span class="line">    		  <span class="keyword">var</span> srcArray = src.split(<span class="string">'/'</span>).filter(<span class="function"><span class="keyword">function</span>(<span class="params">elem</span>)</span>&#123;</span><br><span class="line">    			<span class="keyword">return</span> elem != <span class="string">''</span> &amp;&amp; elem != <span class="string">'.'</span>;</span><br><span class="line">    		  &#125;);</span><br><span class="line">    		  <span class="keyword">if</span>(srcArray.length &gt; <span class="number">1</span>)</span><br><span class="line">    			srcArray.shift();</span><br><span class="line">    		  src = srcArray.join(<span class="string">'/'</span>);</span><br><span class="line">    		  $(<span class="keyword">this</span>).attr(<span class="string">'src'</span>, config.root + link + src);</span><br><span class="line">    		  <span class="built_in">console</span>.info&amp;&amp;<span class="built_in">console</span>.info(<span class="string">"update link as:--&gt;"</span>+config.root + link + src);</span><br><span class="line">    		&#125;</span><br><span class="line">    	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    		<span class="built_in">console</span>.info&amp;&amp;<span class="built_in">console</span>.info(<span class="string">"no src attr, skipped..."</span>);</span><br><span class="line">    		<span class="built_in">console</span>.info&amp;&amp;<span class="built_in">console</span>.info($(<span class="keyword">this</span>));</span><br><span class="line">    	&#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      data[key] = $.html();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>然后将所引用的图片放在<code>_posts</code>下与文章同名文件夹下<img src="/2020/01/28/%E9%85%8D%E7%BD%AEHexo%E7%9A%84%E5%8E%86%E7%A8%8B%E5%92%8C%E4%B8%80%E4%BA%9Bbug%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%E7%A4%BA%E4%BE%8B%E6%88%AA%E5%9B%BE.PNG" class></li>
<li>用hexo语法，如我的示例引用：<pre><code><font color="white"> {% asset_img 文件路径示例截图.PNG %}</font></code></pre></li>
<li>请注意你的图片命名不要有<strong>空格</strong>，不然也会不显示。</li>
<li>之后你的博客文章引用的图片在主页和归档等子页面都可以正常显示了。</li>
</ul>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/01/28/%E9%85%8D%E7%BD%AEHexo%E7%9A%84%E5%8E%86%E7%A8%8B%E5%92%8C%E4%B8%80%E4%BA%9Bbug%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" data-id="ck8ilx0ru000h8wue2fj9hit2"
        class="article-share-link">分享</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8D%9A%E5%AE%A2/" rel="tag">博客</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-开门之作——小白HTML-CSS-JavaScript入门摸索历程" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/28/%E5%BC%80%E9%97%A8%E4%B9%8B%E4%BD%9C%E2%80%94%E2%80%94%E5%B0%8F%E7%99%BDHTML-CSS-JavaScript%E5%85%A5%E9%97%A8%E6%91%B8%E7%B4%A2%E5%8E%86%E7%A8%8B/"
    >开门之作——小白HTML-CSS-JavaScript入门摸索历程</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/01/28/%E5%BC%80%E9%97%A8%E4%B9%8B%E4%BD%9C%E2%80%94%E2%80%94%E5%B0%8F%E7%99%BDHTML-CSS-JavaScript%E5%85%A5%E9%97%A8%E6%91%B8%E7%B4%A2%E5%8E%86%E7%A8%8B/" class="article-date">
  <time datetime="2020-01-28T11:32:14.170Z" itemprop="datePublished">2020-01-28</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%92%8C%E7%BC%96%E7%A8%8B/">软件和编程</a>
  </div>

      
      
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>
我是一个非计算机专业的同学，不过也因为时代发展，专业需要，也会用python写一些小代码。<br>

</p><p>平时呢热爱<strong>摄影、视频制作、还有视觉上好看的事物</strong>。</p>
<p>我想开始学Web Design技术也主要是因为，我喜欢的一个YouTuber他的大学专业也本来是网页设计……<strong>Peter Mckinnon!</strong><br></p>
<p>好了正式开始！</p>
<p></p>

<h2>1. 学习资源</h2>
<strong>地址：</strong><u><a href="https://developer.mozilla.org/zh-CN/docs/Learn/Getting_started_with_the_web" target="_blank" rel="noopener"><strong>MDN Web Docs</strong></a><br></u>

<p>这是一个<strong>非常优质</strong>、可以称之为<strong>鼻祖</strong>的<strong>Mozilla</strong>开源社区项目。它其中详细介绍了<strong>Web Design</strong>的各种基础技术知识。好好学，系统性地学，真的会有巨大的收获。<br>而且大多数内容都有中文版本。</p>
<img src="/2020/01/28/%E5%BC%80%E9%97%A8%E4%B9%8B%E4%BD%9C%E2%80%94%E2%80%94%E5%B0%8F%E7%99%BDHTML-CSS-JavaScript%E5%85%A5%E9%97%A8%E6%91%B8%E7%B4%A2%E5%8E%86%E7%A8%8B/MDN%E6%88%AA%E5%9B%BE.PNG" class>

<h2>2. 我的入门历程</h2>

<ul>
<li>花1-2天时间阅读、上手操作HTML部分教程：<ul>
<li>了解<code>HTML</code>的结构<code>&lt;head&gt;,&lt;body&gt;,&lt;script&gt;</code>等；</li>
<li>知道文本<code>&lt;p&gt;</code>(<code>&lt;h1&gt;&lt;div&gt;&lt;span&gt;</code>)、列表<code>&lt;ul&gt;&lt;ol&gt;</code>、超链接<code>&lt;a href&gt;</code>、表格<code>&lt;table&gt;</code>、表单<code>&lt;form&gt;</code>的格式、用途；</li>
<li>接触<code>CSS</code>的样式知识；</li>
<li>知道如何选择特定内容<code>querySelector</code>；</li>
<li><strong>表单<code>&lt;form&gt;</code>那里创建对象响应可能有些难，不过没关系，先仿照着学下去</strong>！</li>
</ul>
</li>
<li>花1天时间学习CSS部分教程：<ul>
<li>了解<code>CSS</code>结构；</li>
<li>知道如何选择特定部分，并修改样式；</li>
<li>学习网页排版位置设置知识&nbsp;(<font color="#2e6da4">虽然这里我也没有好好学就跳过了</font>);</li>
</ul>
</li>
<li>花3-4天时间学习JavaScript部分教程:<ul>
<li>变量、函数、循环等编程基础与其他编程语言大同小易，这个基础应该原本就具备；</li>
<li>学会动态操纵文档，<strong><code>DOM</code>树操作</strong>非常重要！</li>
<li>会在浏览器<code>Console控制台</code>调试程序;</li>
<li>控件响应事件学习,<strong>这样静态网页才能动起来</strong>；</li>
<li><strong>其他还有更深层次的前端知识，异步处理，<code>Canvas、OpenGL</code>画图等等我先没有具体去学</strong>，<br>因为我的初衷是创建一个个人博客，就急于来自己上手尝试了。<strong>在此还是强烈建议有识之士去好好学习的。</strong></li>
</ul>
</li>
</ul>
<h2>3. 心得小结</h2>

<p>虽然我自己也没有完完全全吃透<strong>MDN</strong>官方教程上的内容，但是自己这几天照着官方文档和示例去学习，主要有两大感受：</p>
<ul>
<li><strong>系统性</strong>！这个教程比其他网络上的博客或者一些网站更专业更全面，并且有示例源码可以仿照学习。</li>
<li><strong>开心啊</strong>！终于自己可以看懂之前一些html网页源码内容，对于无论是<strong>爬虫、调用API、Echarts使用</strong>等等都很有帮助。</li>
</ul>
<p>这个教程非常棒，以后遇到很多困惑都可以再回去查，而且发现网络上很多的解决方案的原始链接都是它！快去学习一下鼻祖的<strong>MDN Web Docs</strong>吧！</p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/01/28/%E5%BC%80%E9%97%A8%E4%B9%8B%E4%BD%9C%E2%80%94%E2%80%94%E5%B0%8F%E7%99%BDHTML-CSS-JavaScript%E5%85%A5%E9%97%A8%E6%91%B8%E7%B4%A2%E5%8E%86%E7%A8%8B/" data-id="ck8ilx0rq000b8wue0fz22dio"
        class="article-share-link">分享</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTML/" rel="tag">HTML</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/css/" rel="tag">css</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/markdown/" rel="tag">markdown</a></li></ul>

    </footer>

  </div>

  

  
  
  

  

</article>
    
  </article>
  

  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>
        &copy;
        2020
        Eva Ren
      </li>
      <li>
        
          Powered by
        
        
        <a href="https://hexo.io" target="_blank">Hexo</a> Theme <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul class="list-inline">
      <li>

        
        
        <ul class="list-inline">
<!--  <li>PV:<span id="busuanzi_value_page_pv"></span></li>-->
<!--  <li>UV:<span id="busuanzi_value_site_uv"></span></li>-->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <li>本站总访问量 <span id="busuanzi_value_site_uv"></span>次</li>
  <li>本页面总访问量 <span id="busuanzi_value_page_pv"></span>次</li>
</ul>

<script>
  $(document).ready(function () {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var pvcountOffset = 0;  // 初始化首次数据
    var uvcountOffset = 0;

    function fixCount() {
      if (document.getElementById("busuanzi_container_site_pv").style.display != "none") {
        $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + pvcountOffset);
        clearInterval(int);
      }
      if ($("#busuanzi_container_site_pv").css("display") != "none") {
        $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + uvcountOffset); // 加上初始数据
        clearInterval(int); // 停止检测
      }
    }
  });
</script>
        
      </li>
      <li>
        <!-- cnzz统计 -->
        
      </li>
      <li>
        
          <span id="sitetime">载入运行时间...</span>
          <script>
            function siteTime() {
              var seconds = 1000;
              var minutes = seconds * 60;
              var hours = minutes * 60;
              var days = hours * 24;
              var years = days * 365;
              var today = new Date();
              var startYear = "2020";
              var startMonth = "1";
              var startDate = "30";
              var startHour = "0";
              var startMinute = "0";
              var startSecond = "0";
              var todayYear = today.getFullYear();
              console.log(startYear);
              console.log(todayYear);
              var todayMonth = today.getMonth() + 1;
              var todayDate = today.getDate();
              var todayHour = today.getHours();
              var todayMinute = today.getMinutes();
              var todaySecond = today.getSeconds();
              var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
              var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
              var diff = t2 - t1;
              var diffYears = Math.floor(diff / years);
              var diffDays = Math.floor((diff / days) - diffYears * 365);
              var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
              var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                      minutes);
              var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                      diffMinutes * minutes) / seconds);
              if (startYear == todayYear) {
                document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                        " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
              } else {
                document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                        " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
              }
            }
            setInterval(siteTime, 1000);
          </script>
        
      </li>
    </ul>
  </div>

</footer>


    <div class="to_top">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>
      </div>
    </main>
      <aside class="sidebar">
        <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/山.svg" alt="To the MOUNTAIN"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about/">联系我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
      </aside>
      <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
      
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>



<script src="/fancybox/jquery.fancybox.min.js"></script>





<script>
  var ayerConfig = {
    mathjax: false
  }
</script>


<script src="/js/ayer.js"></script>


<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>




<script type="text/javascript" src="https://js.users.51.la/20544303.js"></script>
  </div>
</body>

</html>